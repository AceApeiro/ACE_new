<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ACE – Author Group Fix</title>
<style>
body { font-family: Arial, sans-serif; background:#0b1220; color:#e5e7eb; padding:20px }
pre { background:#020617; padding:15px; overflow:auto }
button { padding:10px 16px; background:#22c55e; border:none; cursor:pointer }
</style>
</head>

<body>
<h1>ACE – Author Group Generator (FIXED)</h1>

<button onclick="run()">Run Extraction</button>
<pre id="out"></pre>

<script>
/**
 * SIMULATED PDF PARSE RESULT
 * (Replace later with pdf.js output – logic stays the same)
 */
const pdfAuthors = [
  { name: "Zhe Wang", markers: ["1","2"] },
  { name: "Zenan Liu", markers: ["1","2"] },
  { name: "Zhiyan Wang", markers: ["1","2"] },
  { name: "Yi-Ming Ding", markers: ["1","2"] },
  { name: "Zheng Yan", markers: ["1","2"] },
  { name: "Zehui Deng", markers: ["3"] },
  { name: "Long Zhang", markers: ["4"] },
  { name: "Wenan Guo", markers: ["5","6"] }
];

const affiliations = {
  "1": "Department of Physics, School of Science, Westlake University",
  "2": "Institute of Natural Sciences, Westlake Institute for Advanced Study",
  "3": "Beijing Computational Science Research Center",
  "4": "Kavli Institute for Theoretical Sciences, UCAS",
  "5": "School of Physics and Astronomy, Beijing Normal University",
  "6": "Key Laboratory of Multiscale Spin Physics, Beijing Normal University"
};

function buildAuthorGroups(authors, affs) {
  const groups = {};

  authors.forEach(a => {
    a.markers.forEach(m => {
      if (!groups[m]) groups[m] = [];
      groups[m].push(a.name);
    });
  });

  return Object.entries(groups).map(([id, names], idx) => ({
    seq: idx + 1,
    affiliation: affs[id],
    authors: names
  }));
}

function run() {
  const groups = buildAuthorGroups(pdfAuthors, affiliations);

  let xml = `<units>\n  <unit>\n    <bibrecord>\n`;

  groups.forEach(g => {
    xml += `      <author-group seq="${g.seq}">\n`;
    g.authors.forEach((name,i) => {
      const parts = name.split(" ");
      xml += `        <author seq="${i+1}">\n`;
      xml += `          <ce:given-name>${parts[0]}</ce:given-name>\n`;
      xml += `          <ce:surname>${parts.slice(1).join(" ")}</ce:surname>\n`;
      xml += `        </author>\n`;
    });
    xml += `        <affiliation>\n`;
    xml += `          <ce:source-text>${g.affiliation}</ce:source-text>\n`;
    xml += `        </affiliation>\n`;
    xml += `      </author-group>\n`;
  });

  xml += `    </bibrecord>\n  </unit>\n</units>`;

  document.getElementById("out").textContent = xml;
}
</script>
</body>
</html>
